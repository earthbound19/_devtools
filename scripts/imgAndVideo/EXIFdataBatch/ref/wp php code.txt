/* Automatically populate image attachment metadata */
/* Re: http://www.piotr.szczepanski.name/tech/img-alt-title-exif/ */
 
function aqq_populate_img_meta($post_id)
    {
    // Get EXIF data from the attachment file
    $exif = exif_read_data(get_attached_file($post_id));
    $exif_excerpt = wp_slash(wp_strip_all_tags($exif['DocumentName']));
    $exif_img_alt = wp_slash(wp_strip_all_tags($exif['ImageDescription']));
 
    // Update the caption, which is stored in the excerpt field
    if(!empty($exif_excerpt))
        wp_update_post(array('ID' => $post_id, 'post_excerpt' => $exif_excerpt));
 
    // Update the alternative text, which is stored in post meta table
    if(!empty($exif_img_alt))
        update_post_meta($post_id, '_wp_attachment_image_alt', $exif_img_alt);
    }
 
add_filter('add_attachment', 'aqq_populate_img_meta');